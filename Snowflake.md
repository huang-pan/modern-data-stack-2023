# Snowflake

## Snowflake

- https://medium.com/@noah.goodrich/snowflake-vs-databricks-revisited-edd8201b5799
	- Snowflake cheaper for orgs than Databricks https://squadrondata.com/databricks-vs-snowflake-org-impact-analysis/
	- https://www.fujitsu.com/au/imagesgig5/A%20Practitioners%20Guide%20to%20Databricks%20vs%20Snowflake.pdf
	- Snowfake a lot easier to use than Databricks, but hard to control costs at larger scale
 	- Databricks may require a lot of time maintaining / optimizing. But it may work well for extremely large data, see: https://blog.dataengineer.io/p/how-to-optimize-100-tb-data-pipelines
	- Try both and see what works the best for your business requirements
- https://www.linkedin.com/posts/nick-akincilar-3417945_benchmarking-snowflake-vs-spark-to-optimize-activity-7130908981018943489-_8ei/
	- Snowflake 2x faster than Spark for the same ETL process given the same compute size
- https://docs.snowflake.com/en/guides-overview 
- features
	- https://docs.snowflake.com/en/user-guide/tables-external-intro
	- https://docs.snowflake.com/en/user-guide/object-clone 
	- schema evolution
		- https://docs.snowflake.com/en/user-guide/data-load-schema-evolution
  		- This feature is limited to COPY INTO <table> statements and Snowpipe data loads. INSERT operations cannot evolve the target table schema automatically.
    		- Snowpipe Streaming data loads are not supported with schema evolution.
	- snowpipe, snowpipe streaming
	- tasks
		- https://docs.snowflake.com/en/user-guide/tasks-intro
		- A task can execute any one of the following types of SQL code:
			- Single SQL statement
			- Call to a stored procedure
			- Procedural logic using Snowflake Scripting
		- Pipelines: Tasks can be combined with table streams for continuous ELT workflows to process recently changed table rows. Streams ensure exactly once semantics for new or changed data in a table.
  		- https://julielovesdata.medium.com/value-passing-in-snowflake-tasks-3a19e10a30a4
	- Dynamic tables
		- https://docs.snowflake.com/en/user-guide/dynamic-tables-about
			- https://youtu.be/4O2_I25izIs?si=Mt_dBHBr6kM9puL2 
			- streams and tasks: imperative way of creating pipelines
				- SQL can be optimized more than dynamic tables
				- can use serverless tasks
			- dynamic tables: declarative way of creating pipelines
				- figures out merge / insert / delete statement
				- best for incremental refresh tables, not suitable for very large tables
				- no serverless option
			- auto pipeline, replaces streams and tasks
			- no schema evolution
		- https://docs.snowflake.com/en/user-guide/dynamic-tables-comparison
  		- https://coalesce.io/product-technology/slowly-changing-dimensions-with-dynamic-tables-and-coalesce/
	- https://coalesce.io/ dbt for Snowflake
 	- Snowflake can read Iceberg in external storage space
  		- https://youtube.com/watch?v=Ix2BZV1AjxA&si=th1tfQ9KDZWFsDaG
    		- Need separate AWS Glue Catalog in conjunction with Snowflake Catalog
- performance
	- warehouse structure
		- 1 extra small snowflake warehouse for Airflow jobs
			- fewest number of queries
			- query planner to see if long running queries are more efficient
				- break down queries, add intermediate tables
			- periodic COPY INTO cheaper than Snowpipe
		- 1 small / medium for analysts, data scientists
		- 1 small / medium for Sigma Computing
	- warehouse auto-scaling
	- multicluster warehouses
	- caching
	- query acceleration service
		- https://docs.snowflake.com/en/user-guide/query-acceleration-service
	- search optimization service
		- https://docs.snowflake.com/en/user-guide/search-optimization-service
- optimization
	- https://docs.snowflake.com/en/user-guide/tables-clustering-micropartitions
		- tables are closed source column store format, micro-partitioned
	- set table clustering keys (expensive compute to recluster)
		- https://docs.snowflake.com/en/user-guide/tables-clustering-keys
		- https://docs.snowflake.com/en/user-guide/tables-auto-reclustering
	- query profiling
		- https://docs.snowflake.com/en/user-guide/ui-query-profile
		- https://docs.snowflake.com/en/user-guide/performance-query-exploring
		- https://docs.snowflake.com/en/user-guide/performance-query-warehouse
	- https://www.analytics.today/blog/top-3-snowflake-performance-tuning-tactics
		- split tables, use materialized views
		- optimize queries
			- OBT, but only select needed columns in queries
				- use LIMIT in queries
	- https://medium.com/@gupta.sahil.201191/snowflake-performance-optimization-techniques-9d135e07ef37
 	- dbt runs use up a lot of snowflake compute; consider SQLmesh instead
- RBAC
	- https://hevodata.com/learn/snowflake-roles/#3
		- orgadmin, accountadmin, securityadmin, sysadmin, etc.
	- Row Access Policies https://docs.snowflake.com/en/user-guide/security-row-intro 
	- Dynamic Data Masking down to column level https://docs.snowflake.com/en/user-guide/security-column-ddm-intro 
- Warehouse load monitoring, cost controls
	- https://docs.snowflake.com/en/user-guide/warehouses-load-monitoring
	- https://docs.snowflake.com/en/guides-overview-cost 
		- https://docs.snowflake.com/en/user-guide/cost-controlling 
	- Sigma has Snowflake Cost Monitoring Dashboard
		- https://www.sigmacomputing.com/interactive-demos/snowflake-cost-monitoring-template
	- https://sonra.io/snowflake/7-guardrails-against-common-mistakes-that-inflate-snowflake-credit-usage/
   	- Understand, Control, And Optimize Spend In Snowflake More Effectively
		- https://youtube.com/watch?v=Dwf11NxNqbw&si=9QTlHnx6ZEkAE-Wr
   	- Reduce Costs With Snowpipe Streaming And Dynamic Tables
		- https://youtube.com/watch?v=y67bH9ss07Y&si=RYzbsnPGqtWt2mAU 
- Data Lineage
	- https://www.phdata.io/blog/ultimate-guide-to-data-lineage-directly-in-snowflake/
 	- https://www.metaplane.dev/blog/the-definitive-guide-to-snowflake-data-lineage
  	- https://community.snowflake.com/s/question/0D53r0000BZbxJgCQJ/how-do-you-address-data-lineage
  		- coalesce, dbt, atlan, databand.ai, etc.
- Dynamic Data pipelines with SQL Macros (like dbt macros)
	- https://youtu.be/4O2_I25izIs?si=Mt_dBHBr6kM9puL2
![dynamicpipeline](https://github.com/huang-pan/modern-data-stack-2023/assets/10567714/ce7db7eb-d24e-47a1-aaef-daf2c5f881e7)
![sqlmacro](https://github.com/huang-pan/modern-data-stack-2023/assets/10567714/57df1e49-9081-4cc6-a16f-3f9d53863d55)
![dynamicsql](https://github.com/huang-pan/modern-data-stack-2023/assets/10567714/d629c549-b7a9-46c5-8906-68027caf125c)
- Level Up Your Spark Pipelines With Hex And Snowpark
	- https://youtube.com/watch?v=8IGP72KxTBw&si=Sw0hl_YUFY9hawra
 	- pyspark to snowpark
		- https://youtube.com/watch?v=M7uAWoPKMsg&si=-wqneWvcng5MY4Cn 
- Building a Comprehensive Data Science Platform on Snowflake at Regions Bank
	- https://youtube.com/watch?v=z2zdIzfuNQo&si=Bnq4gAlJw-YqgRmb
- Fast, Easy, And Secure AI/ML Development And Deployment In Snowflake
	- https://youtube.com/watch?v=3WqDHoBGzPM&si=JyrCl3AQ7uIoSHs2
 ![snowflake ml](https://github.com/huang-pan/modern-data-stack-2023/assets/10567714/d30f2d29-7b8d-4687-add5-af210c930e10)
- Unstructured data in Snowflake
	- https://youtube.com/watch?v=9YQTqQ2Ow48&si=erFkfj3O8g5oPoBK
![snowflake unstructured](https://github.com/huang-pan/modern-data-stack-2023/assets/10567714/a1246109-a5bd-4635-93ac-1393e3d5e4d9)
- Snowflake + dbt
	- https://youtu.be/84RA7TuhCpg?si=_QxarT8WvkgMMsI4
- Snowflake & dbtvault
	- https://youtube.com/watch?v=u3LNHgUqFg4&si=jqXzh7mWm9Ez-aKz
- Snowflake + tinybird real time API speed layer
	- https://youtube.com/live/IOuXREaJj5Q?si=cwJJ3RqIbxqUHBDK
 	- tinybird kafka ingest  https://www.youtube.com/watch?v=ia_BN9AU-do
- data.world Snowflake native Data Catalog https://youtu.be/LcOel1im0tI?si=4KFtHDJBVh8KY4bz
- https://www.snowflake.com/blog/ml-enhances-mlops-streaming-feature-model-management/
	- ****Snowflake ML has a model registry and feature store****
- Snowflake 2024
	- [Snowflake 2024.pdf](https://github.com/user-attachments/files/15842303/Snowflake.2024.pdf)
